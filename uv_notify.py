# -*- coding: utf-8 -*-
"""UV_notify.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1f8A6ltXU8z9XsUgOfYki4DI9dmHosrQv
"""

import requests

#UVæŒ‡æ•°ã®å–å¾—
def get_uv_index(lat, lon, token):
    url = f"https://api.openuv.io/api/v1/uv?lat={lat}&lng={lon}"
    headers = {"x-access-token": token}
    response = requests.get(url, headers=headers)
    data = response.json()
    uv = data["result"]["uv"]
    uv_max = data["result"]["uv_max"]
    return uv, uv_max

# import os
# api_key = os.environ["UV_API"]

# import openai
# from google.colab import userdata
# openai.api_key = userdata.get('UV_API')


# # ä¾‹ï¼šæ±äº¬ã®ç·¯åº¦çµŒåº¦
# message = get_uv_index(35.6895, 139.6917, UV_API)


from google.colab import userdata
uv_api = userdata.get('UV_API')

# message = get_uv_index(35.6895, 139.6917, uv_api)

# UVå–å¾—
uv, uv_max = get_uv_index(43.0621, 151.3544, uv_api)

# print (message)



import requests

def send_discord_webhook(webhook_url, message):
    payload = {"content": message}
    headers = {"Content-Type": "application/json"}
    response = requests.post(webhook_url, json=payload, headers=headers)
    return response.status_code



webhook_url= "https://discordapp.com/api/webhooks/1397136606628151316/v0UAVc7Od_S8h9nOCXGr6xjdcZvkJ3WdYig6rsQdLjazH2A8Iyqqp_KLzHLFK-MQuEC8"

def uv_level_info(uv):
    if uv <= 2:
        return "ğŸ§¢ å®‰å¿ƒãƒ¬ãƒ™ãƒ«ï¼šUVæŒ‡æ•°ã¯ä½ã‚ã€‚ç‰¹åˆ¥ãªå¯¾ç­–ã¯ä¸è¦ã§ã™ã€‚"
    elif uv <= 5:
        return "ğŸŒ¤ æ³¨æ„ãƒ¬ãƒ™ãƒ«ï¼šã˜ã‚ã˜ã‚ç´«å¤–ç·šãŒæ¥ã¦ã¾ã™ã€‚å¸½å­ã‚„æ—¥ç„¼ã‘æ­¢ã‚ã‚’ï¼"
    elif uv <= 7:
        return "â˜€ï¸ é«˜ã‚ãƒ¬ãƒ™ãƒ«ï¼šUVæŒ‡æ•°ãŒé«˜ã„ã§ã™ã€‚æ—¥é™°ã‚„å¯¾ç­–ã‚’å¿ƒãŒã‘ã¦ï¼"
    elif uv <= 10:
        return "ğŸ”¥ å¼·çƒˆãƒ¬ãƒ™ãƒ«ï¼šç´«å¤–ç·šãŒå¼·ã„ï¼ã‚µãƒ³ã‚°ãƒ©ã‚¹ãƒ»é•·è¢–å¿…é ˆã§ã™ã€‚"
    else:
        return "ğŸš¨ å±é™ºãƒ¬ãƒ™ãƒ«ï¼šUVæŒ‡æ•°ãŒéå¸¸ã«é«˜ã„ï¼ãªã‚‹ã¹ãå¤–å‡ºã‚’æ§ãˆã¦ï¼"

import requests
from datetime import datetime, timezone, timedelta

def send_discord_embed(webhook_url, uv_value, uv_max, location="æ±äº¬"):
    embed = {
        "title": f"â˜€ï¸ {location}ã®UVæŒ‡æ•°ãƒ¬ãƒãƒ¼ãƒˆ",
        "description": f"ç¾åœ¨ã®UVæŒ‡æ•°ï¼š**{uv_value:.1f}**\næœ¬æ—¥ã®æœ€å¤§UVæŒ‡æ•°ï¼š**{uv_max:.1f}**\n\n{uv_level_info(uv_value)}",
        "color": 16763904,  # ã‚ªãƒ¬ãƒ³ã‚¸ç³»ï¼ˆ16é€²ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼‰
        "footer": {"text": "è‚Œã‚’å®ˆã£ã¦ã€è³¢ãUVå¯¾ç­–ï¼"},
        "timestamp": datetime.now(timezone(timedelta(hours=9))).isoformat()

    }

    payload = {
        "username": "UV Forecast Bot",
        "embeds": [embed]
    }

    headers = {"Content-Type": "application/json"}
    response = requests.post(webhook_url, json=payload, headers=headers)
    return response.status_code



status = send_discord_embed(webhook_url, uv, uv_max, location="æœ­å¹Œ")

if status == 204:
    print("Discordã«é€šçŸ¥ã§ãã¾ã—ãŸï¼ğŸ‰")
else:
    print(f"é€šçŸ¥ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆstatus: {status}ï¼‰")